<img src="./logo.png" alt="Logo" width="100"/>

# Vietnamese News API

[![JavaScript](https://img.shields.io/badge/-f0db4f?style=for-the-badge&lableColor=323330&logo=javascript&logoColor=323330)](https://www.javascript.com/)
[![MongoDB](https://img.shields.io/badge/-3fa037?style=for-the-badge&logo=mongodb&logoColor=white)](https://www.mongodb.com/)
[![ExpressJS](https://img.shields.io/badge/4.18.2-white?style=for-the-badge&logo=express&logoColor=black)](https://www.npmjs.com/package/express)
[![Mongoose](https://img.shields.io/badge/7.0.2-880000?style=for-the-badge&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD4AAAAeCAYAAAB0ba1yAAAABHNCSVQICAgIfAhkiAAABYhJREFUWIXtmG1oZHcVxn/PnUxmku3GGN3sbjC648wwSbptWbuiFmqxUhC0tiyK+IJIq1AsfhPfEXyhIIK0WAtSEHxDQVxpd4Ua2kKh1QWh3a6amezNbtC4TZpaN5vN5m3u3McPMwmTdJLMppkUZH9wP8yd8z/nPOf+X869cI1rXOMa/4fojU7AdvLChQtd5XI5CZBMJsu25/v7+xdaGXfXhI+Ojn42juO7bQeSpmyfAU5Juhn4HNABREAZmAcuS3rV9r8lnQNKXV1dI319ffM7kU9LhI+Ojg7Y7pPUFcdxBXgV+CFwS53Zcu2ak3TK9ruAtzdwV6FajDLVwrws6WngT6lUajiTySxuJ8fXJXxiYqJjcXHxuiiK3gscs/1BSf0NTH9vez/QI+lXku61/TYgVWcTA8E20igBx4HjnZ2d5+M4XmimGNsSHoZhNo7jW+I4vgv4CGsFNOJxQLZzQ0NDQwDFYvEYcB9wxxZjDfzH9iuS9gNv2cR20vZTQRA8bftMOp3+x0ZFuCrhY2Njh6Mo+qLt24FCs+MknQaGbX/F9ieHhoZ+C2A7USqVfgR8BujZYLiBGeCxIAgeieN4v6Sc7SO2j0oa2mDcpKQRqkvil5lMZmpNTs0kHoZhVxRFDwLHgK5mx60JJN1j+7tAe3t7+7uz2ey/isXiMUlDcRx/XVLnVj5s/wz4STKZHGtvb08sLCz0AgXbDwKZDcZEkmaBJ9Lp9L0rM2BTAePj4+nl5eW74jh+FNh7tWLXUQK+B/wa+PPevXs/Ojc312X7NNVitpoLtmcllQcGBo4kNrI6e/bse8rl8k9tf42t13AzvFXSvKQTwKeXl5ePBkHwvO0MkNsB/1sxIykHBDMzMw81FF4sFr9t+8fADTsc/CZg1vZjkj4F3Eb1zD60w3EasbJEHyoUCsNrpvrU1NSeixcvDgPvo7XNTQn4DXA/0NvCOOtZHBgY2CMpXn3iYRgemZ+f/wvwTklXgCvAy8BLtpckrTQSMdBGg8LYjmr/r16SGp3NPcDttv8AjAdBcABIN5t9bcNaqsWYproUG87eWk6LkiZsf6i3t/clVpIPwzAbRdFXJYW2/5pMJs/lcrmJdQ6C8+fP58rl8o223w98ADhcZxJLesD2akspKbL9BSBfZ/ci8ItasinblSAIUsD9tru30PwKcK4m+LLtPZKOsrZol4HJlUvSaUnPFQqFZ+sdCWB6evq6ffv2zUuKtwi8ytjYWH+5XL4b+A7wZttRT09P94EDB67U242MjNwhabju1o2Dg4N/q7cpFos3AE8AfZuEfBKYoLrv5IE31e5PA89LehH4e623n0wkEpP5fH52I2dtAL29vXNNqa0jl8tN2H64WCw+LumkpMNRFKWpLpFVuru7n7t06dIJ4E7g0fWia7RvEW7W9guS7qHauT0DnEwkEk8mEonxjo6O8sGDB5clRc3m39asYSMkGfjn6OjoxyuVyvFGNn19ffOlUukR4Na2trZvbTNUF3A90A18c3Bw8IFt+lllOy8Fr6FQKJQSicSX6td3PalU6pSkO7PZ7H+3G0PSrVTf1HbkiH1dT7yeQqHwVKP74+Pj6UwmMwOsbi5hGKby+fzSJu7OACclFSVdieM4CoKgUqlUypKWdyLfHRO+EUtLSw8Dn1/5XSqVvl+pVH4ArBcuwJI+kUqlThw6dCi6mjV7tezIVN8M2x8ulUofAygWi7fZ/nKhUFjzWUmSgHJbW9vNAwMDv8tkMoutFA27IFxS2vY3wjC8Hvg51V1/TfOTTCYvBUFwXz6ff6HV+azQ8qluOwZuiqLoj1Q/Lb1mg8tmsyEQtjqXelouvEYAvGOXYjXFbgivAHHtyVPr+b0LcTel5cJr/XtnrdlB0jzVYryh/A9mmEqbF3ek9gAAAABJRU5ErkJggg==)](https://www.npmjs.com/package/mongoose)
[![jsdom](https://img.shields.io/badge/21.1.1-dbc01d?style=for-the-badge&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAArlBMVEVHcEzbwB3bwB3bwB3OtRq/pxnbwB3bwB3bwR3bvx3bwBzcwB3MtBvbwB3bwB3XvBzYvRzbwB3bwB3bwB3bwB1USgo+OAi/qBjbwB1QSApVTAvbwB1JQglEPgmhjxV4axA4MwfbwB3dwR02MgfVuxxdUwx0Zw9HQAk/OQfavx2/qBmJeRJVTAs8NgfQtxtnWw23oRjJsRqWhBOfjBSumRZORgqAcRDDrBqlkRVHcEyJO7kKAAAAOnRSTlMARHOpDAXy6SUw3lUa/Dtr2CyUxIxh8Re0eki+zri2t/////////////////////////////////8AwFqhFgAAAk1JREFUSMfFlnlzqjAUxeuKRa120e7vkRuEIDuu3/+TvZAdROU5nen9w5lm+PWec0Jyubv7xep3ut1O/z+AQedtiNCw1xm0JR6fLMTKenpsBUy6NlJldyfXTYyfp8io6fP4sqXBQ2+IajXsPVywNHqxUENZL6MzwGt3rp4CVurP+ey10cSnNuEmZbmutvR5Ymlwb5qA7YpWmm50nym1VCVmtikeCgeXFYKZnT0zYxhXc4IQO2UVUI2hY/h4q0bkegwhxyqCetrPqJZtEpUI9rMaYutX4b6KQEYYsstriDU6h6CQOXFSF7VEIGe6HLwP2nYJRBPHD3OANghsfR6xg53VxoXrCGSRIEqIeAe4hsB6pQnWaKsdNSKakCD2CyWuCdFETBRD9gmcR7Qqb5vGsl/siT09RSBTqtIckmKnXHm8zymifaQ0J4C1Jxs5XFsdMbJKebK0kS+1hWUGNQTyVPaI1sIuBHuVQRHUEUg8tRf+ViLrCJuLVSQIY72BK54QiKPGmdUBKggcfXPTw4AhG2IsYs+tIAehABvSlCzxS44GMrL34t/5sVBBX3sla0fE4lwf5P4fLgvvjvKxMJCycJSJxfivcf0tlnytgIxvOb0q5NkkG6lwuTCvvvclNwioiPmrmCcha10u8obL98oEGHx8E7yjlxAkKcZOdKTPBeWbyfa1tEW+P+ozo7/4YtFSafIoAm1E2L0M2deiaTJNZmxYBBt14Gkjfr6ah4UeSeZVBMHFkXTT4LtlvJ4M8XmLIX7Tp8JNHyS3fPb8eP0Dm363cawKUX8AAAAASUVORK5CYII=&logoColor=black)](https://www.npmjs.com/package/jsdom)



**Crawl, scrape, store and serve news articles from 3 of the most popular Vietnamese news websites: _[VnExpress](https://vnexpress.net/)_, _[Tuoi Tre](https://tuoitre.vn/)_ and _[Thanh Nien](https://thanhnien.vn/)_.**

> _**Disclaimer:**_ The main purpose of this project is to help me learn more about web scraping, data engineering and REST API. According to the Terms of Services of most news websites, redistributing articles' content is prohibited. I am not responsible for and do not endorse any misuse of the tool or data retrieved using it. The RapidAPI endpoint only serves the metadata of the articles, not their content.

## Table of Contents

- [API Documentation](#api-documentation)
- [Run locally](#run-locally)
    - [Set up](#set-up)
    - [Usage](#usage)
        - [Run the API server](#run-the-api-server)
        - [Crawl and scrape articles](#crawl-and-scrape-articles)
        - [Query the database](#query-the-database)


## API Documentation

Visit [RapidAPI Hub Listing](https://rapidapi.com/itsdmd/api/vietnamese-news) of this API for usage and demo of the endpoint.

The API provide the following metadata:

- URL
- Title
- Description
- Category
- Topic tags\*
    - Title
    - URL
- Authors’ detail
    - Name
    - Profile URL\*
- Publish date
    - Day, month, year, hour, minute as padded string (“01”, “10”, etc.)
    - ISO Date (yyyy-mm-ddThh:mm:00Z)\*\*

> \*: Can be empty due to website's structure.<br/>
> \*\*: The ISO time will be in UTC+0 timezone. This means that it will be 7 hours behind the timestamp saved in other fields.

The news served by the API are mostly related to politic, business and civic events. Database will be updated hourly.

## Run locally

### Set up

1. This project use [MongoDB](https://www.mongodb.com/) as the database engine. You can either install it [locally](https://www.mongodb.com/docs/manual/installation/) or use a cloud service like [MongoDB Atlas](https://www.mongodb.com/cloud/atlas). Log in and create a new database.

2. **Node.js v18.7.0** & **npm v9.6.2** or higher must be installed on your machine.
    - [Windows](https://nodejs.org/en/download/package-manager#windows-1)
    - [macOS](https://nodejs.org/en/download/package-manager#macos)
    - [Other](https://nodejs.org/en/download/package-manager)

3. Clone this repository and install the dependencies

    ```bash
    git clone https://github.com/itsdmd/VietnameseNewsAPI.git
    cd ./VietnameseNewsAPI/news-api
    npm install
    ```

4. Create `.env` file inside `news-api` directory and add the following environment variables

    ```bash
    # ./news-api/.env

    # MongoDB connection string
    DATABASE_URL="mongodb://<username>:<password>@<host>/<databaseName>?authSource=admin"

    # Default port for the API server
    PORT=3000
    ```

### Usage

#### Run the API server

```bash
npm run start
```

#### Crawl and scrape articles

1. Open [refetch.js](./news-api/src/scripts/refetch.js).
2. Scroll to the bottom of the file.
3. Change the value of the last argument of the functions.
    - The value is the number of pages to crawl to get the articles' URL. Each page contains 15-20 URLs.
    - In the example below, the script will crawl first 7 pages of the latest articles from [tuoitre.vn](https://tuoitre.vn/) (which is around 140 articles) and save them to the database.

    ```javascript
    // ./news-api/src/scripts/refetch.js
    
    await scrape("tt-vn", "https://tuoitre.vn/timeline/3/", "https://tuoitre.vn/timeline/3/trang-1.htm", 7);
    ```

    > :warning: **Warning:** Please do not use a large number. It can cause the website to block your IP address. You can alter the third argument of the function to start from a specific page.

4. Run the script

    ```bash
    npm run refetch
    ```

_**Notice:**_ Older articles might not follow the same structure as the latest ones. The scripts can still scrape most of the metadata fields, but the content might not. You can try uncommenting code blocks supporting legacy structure in [parser.js](./news-api/src/scripts/scraper/parser.js) (find _"legacy"_).

#### Query the database

You can see the schema of the collections in [`models`](./news-api/src/models) directory. To query the database, you can use [mongosh](https://docs.mongodb.com/mongodb-shell/) or any other MongoDB client.

To increase the query and/or sorting speed, you can create an [index](https://www.mongodb.com/docs/v5.0/indexes/) for the fields that you will query regularly. See [documentation](https://www.mongodb.com/docs/manual/reference/method/db.collection.createIndex/).

```bash
# mongosh - Create ascending index for the publish date
db.collection.createIndex( { "metadata.pubdate.isodate": 1 } )
```
